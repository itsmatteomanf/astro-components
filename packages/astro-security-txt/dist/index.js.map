{"version":3,"sources":["../src/integration.ts","../src/libs/validate-options.ts","../src/index.ts"],"sourcesContent":["import { mkdirSync, writeFileSync } from 'node:fs';\nimport type { AstroConfig, AstroIntegration } from \"astro\";\nimport { validateOptions, SecurityTxtOptions } from './libs/validate-options';\nimport { z, ZodError } from 'zod';\n\ntype Options = z.infer<typeof SecurityTxtOptions>;\n\nexport const integration = (options: Options): AstroIntegration => {\n\tconst packageName = 'security-txt';\n\tlet config: AstroConfig;\n\tlet generate = true;\n\tlet validatedOptions: Options;\n\n\treturn {\n\t\tname: packageName,\n\t\thooks: {\n\t\t\t'astro:config:done': async ({ config: cfg, logger }) => {\n\t\t\t\ttry {\n\t\t\t\t\tvalidatedOptions = validateOptions(options);\n\t\t\t\t} catch (error) {\n\t\t\t\t\tif (error instanceof ZodError) {\n\t\t\t\t\t\tgenerate = false;\n\t\t\t\t\t\tlogger.error(`Invalid options for \\`security-txt\\`. \\`security.txt\\` will not be generated.`);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow error;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tconfig = cfg;\n\t\t\t},\n\n\t\t\t'astro:build:done': async ({ dir, logger }) => {\n\t\t\t\tif (!generate) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tlet securityTxtContent = '';\n\n\t\t\t\tsecurityTxtContent += `Expires: ${validatedOptions.expires.toISOString()}\\n`;\n\n\t\t\t\tif (validatedOptions.canonical instanceof Boolean || validatedOptions.canonical === undefined) {\n\t\t\t\t\tif (validatedOptions.canonical || validatedOptions.canonical === undefined) {\n\t\t\t\t\t\tif (!config.site) {\n\t\t\t\t\t\t\tlogger.warn('No `site` provided. `security.txt` has no canonical.');\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsecurityTxtContent += `Canonical: ${config.site}.well-known/security.txt\\n\\n`;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else if (validatedOptions.canonical instanceof Array) {\n\t\t\t\t\tvalidatedOptions.canonical.map((canonical) => {\n\t\t\t\t\t\tsecurityTxtContent += `Canonical: ${canonical}\\n`;\n\t\t\t\t\t});\n\t\t\t\t\tsecurityTxtContent += `\\n`;\n\t\t\t\t}\n\n\t\t\t\tif (validatedOptions.preferredLanguages) {\n\t\t\t\t\tif (validatedOptions.preferredLanguages instanceof Array) {\n\t\t\t\t\t\tsecurityTxtContent += `Preferred-Languages: ${validatedOptions.preferredLanguages.join(', ')}\\n`;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsecurityTxtContent += `Preferred-Languages: ${validatedOptions.preferredLanguages}\\n`;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (validatedOptions.contact instanceof Array) {\n\t\t\t\t\tvalidatedOptions.contact.map((contact) => {\n\t\t\t\t\t\tsecurityTxtContent += `Contact: ${contact}\\n`;\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tsecurityTxtContent += `Contact: ${validatedOptions.contact}\\n`;\n\t\t\t\t}\n\n\t\t\t\tsecurityTxtContent += '\\n';\n\n\t\t\t\tif (validatedOptions.encryption) {\n\t\t\t\t\tif (validatedOptions.encryption instanceof Array) {\n\t\t\t\t\t\tvalidatedOptions.encryption.map((encryption) => {\n\t\t\t\t\t\t\tsecurityTxtContent += `Encryption: ${encryption}\\n`;\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsecurityTxtContent += `Encryption: ${validatedOptions.encryption}\\n`;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (validatedOptions.acknowledgements) {\n\t\t\t\t\tif (validatedOptions.acknowledgements instanceof Array) {\n\t\t\t\t\t\tvalidatedOptions.acknowledgements.map((acknowledgements) => {\n\t\t\t\t\t\t\tsecurityTxtContent += `Acknowledgements: ${acknowledgements}\\n`;\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsecurityTxtContent += `Acknowledgements: ${validatedOptions.acknowledgements}\\n`;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (validatedOptions.policy) {\n\t\t\t\t\tif (validatedOptions.policy instanceof Array) {\n\t\t\t\t\t\tvalidatedOptions.policy.map((policy) => {\n\t\t\t\t\t\t\tsecurityTxtContent += `Policy: ${policy}\\n`;\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsecurityTxtContent += `Policy: ${validatedOptions.policy}\\n`;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (validatedOptions.hiring) {\n\t\t\t\t\tif (validatedOptions.hiring instanceof Array) {\n\t\t\t\t\t\tvalidatedOptions.hiring.map((hiring) => {\n\t\t\t\t\t\t\tsecurityTxtContent += `Hiring: ${hiring}\\n`;\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsecurityTxtContent += `Hiring: ${validatedOptions.hiring}\\n`;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (validatedOptions.csaf) {\n\t\t\t\t\tif (validatedOptions.csaf instanceof Array) {\n\t\t\t\t\t\tvalidatedOptions.csaf.map((csaf) => {\n\t\t\t\t\t\t\tsecurityTxtContent += `CSAF: ${csaf}\\n`;\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsecurityTxtContent += `CSAF: ${validatedOptions.csaf}\\n`;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tmkdirSync(new URL('.well-known', dir), { recursive: true });\n\t\t\t\twriteFileSync(new URL('.well-known/security.txt', dir), securityTxtContent);\n\n\t\t\t\tlogger.info('`security.txt` is created.');\n\t\t\t},\n\t\t},\n\t};\n};\n\nexport default integration;","import { z } from 'zod';\n\nexport const SecurityTxtOptions = z.object({\n\tcontact: z.union([z.string(), z.array(z.string())]),\n\texpires: z.date().optional().default(() => new Date(Date.now() + 1000 * 60 * 60 * 24 * 365)),\n\tencryption: z.union([z.string(), z.array(z.string())]).optional(),\n\tacknowledgements: z.union([z.string(), z.array(z.string())]).optional(),\n\tpreferredLanguages: z.union([z.string(), z.array(z.string())]).optional(),\n\tcanonical: z.union([z.string(), z.array(z.string()), z.boolean()]).optional(),\n\tpolicy: z.union([z.string(), z.array(z.string())]).optional(),\n\thiring: z.union([z.string(), z.array(z.string())]).optional(),\n\tcsaf: z.union([z.string(), z.array(z.string())]).optional(),\n});\n\nexport const validateOptions = (options: unknown) => SecurityTxtOptions.parse(options)","import { integration } from \"./integration.js\";\n\nexport default integration;\n"],"mappings":"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","names":["mkdirSync","writeFileSync","z","SecurityTxtOptions","validateOptions","options","ZodError","integration","options","packageName","config","generate","validatedOptions","cfg","logger","validateOptions","error","dir","securityTxtContent","canonical","contact","encryption","acknowledgements","policy","hiring","csaf","mkdirSync","writeFileSync","src_default","integration"]}