{"version":3,"sources":["../../src/middleware/index.ts"],"sourcesContent":["import { defineMiddleware } from \"astro/middleware\";\nimport { parse } from 'node-html-parser';\n\nexport const onRequest = defineMiddleware(async (_, next) => {\n\tconst html = await next();\n\n\tconst root = parse(await html.text());\n\tconst head = root.querySelector('head')!;\n\n\troot.querySelectorAll('link[rel=\"stylesheet\"]').map((style) => {\n\t\thead.insertAdjacentHTML('afterbegin', `<link rel=\"preload\" as=\"style\" href=\"${style.getAttribute('href')}\">`);\n\t})\n\n\troot.querySelectorAll('script[type=\"module\"]').map((script) => {\n\t\thead.insertAdjacentHTML('afterbegin', `<link rel=\"modulepreload\" href=\"${script.getAttribute('src')}\">`);\n\t})\n\n\treturn new Response(root.toString(), html);\n});"],"mappings":"AAAA,OAAS,oBAAAA,MAAwB,mBACjC,OAAS,SAAAC,MAAa,mBAEf,IAAMC,EAAYF,EAAiB,MAAOG,EAAGC,IAAS,CAC5D,IAAMC,EAAO,MAAMD,EAAK,EAElBE,EAAOL,EAAM,MAAMI,EAAK,KAAK,CAAC,EAC9BE,EAAOD,EAAK,cAAc,MAAM,EAEtC,OAAAA,EAAK,iBAAiB,wBAAwB,EAAE,IAAKE,GAAU,CAC9DD,EAAK,mBAAmB,aAAc,wCAAwCC,EAAM,aAAa,MAAM,CAAC,IAAI,CAC7G,CAAC,EAEDF,EAAK,iBAAiB,uBAAuB,EAAE,IAAKG,GAAW,CAC9DF,EAAK,mBAAmB,aAAc,mCAAmCE,EAAO,aAAa,KAAK,CAAC,IAAI,CACxG,CAAC,EAEM,IAAI,SAASH,EAAK,SAAS,EAAGD,CAAI,CAC1C,CAAC","names":["defineMiddleware","parse","onRequest","_","next","html","root","head","style","script"]}